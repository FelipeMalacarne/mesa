openapi: 3.0.3
info:
  title: Mesa API
  version: 0.1.0
servers:
  - url: https://api.example.com
paths:
  /connections:
    get:
      operationId: ListConnections
      tags:
        - Connections
      summary: List Connections
      responses:
        "200":
          description: Connections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Connection"
    post:
      operationId: CreateConnection
      tags:
        - Connections
      summary: Create Connection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateConnectionRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Connection"

  /connections/{connectionId}:
    get:
      operationId: FindConnection
      summary: Retrieves a connection by ID
      tags:
        - Connections
      parameters:
        - $ref: "#/components/parameters/ConnectionId"
      responses:
        "200":
          description: Connection
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Connection"
        "404":
          description: Not Found

  /connections/{connectionId}/databases:
    get:
      operationId: ListDatabases
      summary: List databases from a connection
      tags:
        - Connections
      parameters:
        - $ref: "#/components/parameters/ConnectionId"
      responses:
        "200":
          description: Databases
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListDatabasesResponse"

  /connections/{connectionId}/databases/{databaseName}/tables:
    get:
      operationId: ListTables
      summary: List tables from a database
      tags:
        - Connections
      parameters:
        - $ref: "#/components/parameters/ConnectionId"
        - $ref: "#/components/parameters/DatabaseName"
      responses:
        "200":
          description: Tables
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListTablesResponse"

components:
  parameters:
    ConnectionId:
      in: path
      name: connectionId
      required: true
      schema:
        type: string
        format: uuid
      description: The unique identifier for the connection
    DatabaseName:
      in: path
      name: databaseName
      required: true
      schema:
        type: string
      description: Database name
  schemas:
    Connection:
      type: object
      required: [id, name, driver, host, port, username, updated_at, created_at]
      properties:
        id:
          type: string
        name:
          type: string
          maxLength: 255
          minLength: 3
        driver:
          type: string
          enum: [postgres, mysql]
        host:
          type: string
          maxLength: 255
          minLength: 1
        port:
          type: integer
          description: A port value between 0 and 65535
          maximum: 65535
          minimum: 0
        username:
          type: string
          maxLength: 255
          minLength: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [ok, error]
        status_error:
          type: string
    Database:
      type: object
      required: [name]
      properties:
        name:
          type: string
    Table:
      type: object
      required: [name, type, row_count, size]
      properties:
        name:
          type: string
        type:
          type: string
        row_count:
          type: integer
          format: int64
        size:
          type: integer
          format: int64
    ListDatabasesResponse:
      type: object
      required: [status, databases]
      properties:
        status:
          type: string
          enum: [ok, error]
        error:
          type: string
        databases:
          type: array
          items:
            $ref: "#/components/schemas/Database"
    ListTablesResponse:
      type: object
      required: [status, tables]
      properties:
        status:
          type: string
          enum: [ok, error]
        error:
          type: string
        tables:
          type: array
          items:
            $ref: "#/components/schemas/Table"
    CreateConnectionRequest:
      type: object
      required: [name, driver, host, port, username, password]
      properties:
        name:
          type: string
        driver:
          type: string
          enum: [postgres, mysql]
        host:
          type: string
        port:
          type: integer
        username:
          type: string
        password:
          type: string
